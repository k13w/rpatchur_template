<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Adicionando o link CDN do Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css" rel="stylesheet">
    <script src="script.js" defer></script>
</head>

<script>
    $(document).ready(function () {
    external.invoke('start_update');
});

function patchingStatusReady() {
    $("#download-progress-bar")
        .css("width", "100%")
        .attr("aria-valuenow", "100")
        .removeClass("bg-warning")
        .removeClass("bg-danger")
        .addClass("bg-success");
    $("#download-progress-text").text("Ready");
    $("#button-play").prop('disabled', false);
}

function patchingStatusError(errorMsg) {
    $("#download-progress-bar")
        .css("width", "100%")
        .attr("aria-valuenow", "100")
        .removeClass("bg-success")
        .removeClass("bg-warning")
        .addClass("bg-danger");
    $("#download-progress-text").text("Failure: " + errorMsg);
}

function patchingStatusDownloading(nbDownloaded, nbTotal, bytesPerSec) {
    var percentage = (100 * nbDownloaded) / nbTotal;
    if (bytesPerSec > 0) {
        var downloadSpeed = " - " + humanFileSize(bytesPerSec) + "/s";
    } else {
        var downloadSpeed = "";
    }
    $("#download-progress-bar").css("width", percentage + "%").attr("aria-valuenow", percentage)
        .removeClass("bg-success")
        .removeClass("bg-danger")
        .addClass("bg-warning");
    $("#download-progress-text").text("Downloading: " + nbDownloaded + "/" + nbTotal + downloadSpeed);
}

function patchingStatusInstalling(nbInstalled, nbTotal) {
    var percentage = (100 * nbInstalled) / nbTotal;
    $("#download-progress-bar").css("width", percentage + "%").attr("aria-valuenow", percentage)
        .removeClass("bg-success")
        .removeClass("bg-danger")
        .addClass("bg-warning");
    $("#download-progress-text").text("Installing: " + nbInstalled + "/" + nbTotal);
}

function patchingStatusPatchApplied(fileName) {
    $("#download-progress-bar")
        .css("width", "100%")
        .attr("aria-valuenow", "100")
        .removeClass("bg-warning")
        .removeClass("bg-danger")
        .addClass("bg-success");
    $("#download-progress-text").text("Successfully applied patch: " + fileName);
}

function notificationInProgress() {
    $('#notificationInProgressToast').toast('show');
}

function resetCache() {
    external.invoke('reset_cache');
    $('#cacheResetToast').toast('show');
}

// Note: Function taken from https://stackoverflow.com/a/20732091
function humanFileSize(size) {
    var i = size == 0 ? 0 : Math.floor(Math.log(size) / Math.log(1024));
    return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kiB', 'MiB', 'GiB', 'TiB'][i];
}

function startGame() {
    var login = document.getElementById('login').value;
    var password = document.getElementById('password').value;
    if (login == "" || password == "") {
        return false;
    }
    // Invoke the patcher's 'login' function
    external.invoke(JSON.stringify({
        function: 'login',
        parameters: {
            'login': login, 'password': password
        }
    }));
    return true;
}
</script>

<body class="bg-gray-100 flex justify-center items-center h-screen">
    <!-- Login Form -->
    <div class="bg-white p-8 rounded-lg shadow-lg w-96">
        <h2 class="text-2xl font-bold text-center mb-6">Login</h2>
        <div class="space-y-4">
            <div class="space-y-1">
                <label for="login" class="block text-sm font-medium text-gray-700">Username</label>
                <input type="text" id="login" placeholder="Username" required class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="space-y-1">
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" placeholder="Password" required class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <button class="w-full bg-green-500 text-white py-3 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500" onclick="startGame()">Login</button>
        </div>
    </div>

    <!-- Progress Bar Wrapper -->
    <div class="mt-8 w-full max-w-sm mx-auto">
        <div class="relative pt-1">
            <div class="flex mb-2 items-center justify-between">
                <div>
                    <span class="text-sm font-semibold inline-block py-1 px-2 uppercase rounded-full text-teal-600 bg-teal-200">
                        Progress
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-teal-600">
                        <span id="download-progress-text">Starting...</span>
                    </span>
                </div>
            </div>
            <div class="flex mb-2 items-center justify-between">
                <div class="w-full bg-gray-200 rounded-full">
                    <div class="bg-orange-500 text-xs leading-none py-1 text-center text-white rounded-full" id="download-progress-bar" style="width: 0%" data-value="0"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
